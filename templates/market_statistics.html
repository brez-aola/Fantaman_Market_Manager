<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Statistiche Market - Fantaman Market Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <header class="app-header">
        <div class="brand">
            <img src="https://raw.githubusercontent.com/marketplaceimages/fantaman-logo.png" alt="Logo">
            <span class="title">Fantaman</span>
        </div>
        <nav class="center">
            <a href="/">Market Manager</a>
            <a href="/rose">Rose Squadre</a>
            <a href="/market">Market</a>
        </nav>
        <div class="account">
            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077012.png" alt="Account">
        </div>
    </header>

    <div style="height:84px;"></div>
    <div style="height:44px;"></div>

    <div class="container">
        <div class="breadcrumb" style="margin-bottom: 20px;">
            <a href="/market">‚Üê Torna al Market</a>
        </div>

        <h1 style="margin-top:0px;">üìä Statistiche Market</h1>

        {% if error %}
        <div class="alert alert-error">
            <strong>Errore:</strong> {{ error }}
        </div>
        {% endif %}

        <!-- Market Overview -->
        {% if market_stats %}
        <div class="stats-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">

            {% if market_stats.total_players %}
            <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #2196f3;">{{ market_stats.total_players }}</div>
                <div style="color: #666; margin-top: 5px;">Totale Giocatori</div>
            </div>
            {% endif %}

            {% if market_stats.free_agents %}
            <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #ff9800;">{{ market_stats.free_agents }}</div>
                <div style="color: #666; margin-top: 5px;">Svincolati</div>
            </div>
            {% endif %}

            {% if market_stats.assigned_players %}
            <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #4caf50;">{{ market_stats.assigned_players }}</div>
                <div style="color: #666; margin-top: 5px;">Assegnati</div>
            </div>
            {% endif %}

            <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 32px; font-weight: bold; color: #9c27b0;">{{ total_teams }}</div>
                <div style="color: #666; margin-top: 5px;">Teams Fantacalcio</div>
            </div>
        </div>

        <!-- Role Distribution -->
        {% if market_stats.role_distribution %}
        <div class="role-stats" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="margin-top: 0;">Distribuzione per Ruolo</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                {% for role, count in market_stats.role_distribution.items() %}
                <div class="role-stat" style="text-align: center; padding: 15px;">
                    <span class="role-badge role-{{ role.lower() }}" style="font-size: 18px; padding: 8px 12px;">
                        {% if role == 'P' %}Portieri
                        {% elif role == 'D' %}Difensori
                        {% elif role == 'C' %}Centrocampisti
                        {% elif role == 'A' %}Attaccanti
                        {% else %}{{ role }}
                        {% endif %}
                    </span>
                    <div style="font-size: 24px; font-weight: bold; margin-top: 10px; color: #333;">{{ count }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% endif %}

        <!-- Team Statistics -->
        {% if team_stats %}
        <div class="team-stats" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="margin-top: 0;">Statistiche Squadre</h2>

            <div class="table-responsive">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Squadra</th>
                            <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Giocatori</th>
                            <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Valore Rosa</th>
                            <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Cassa</th>
                            <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Budget Rimanente</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for team in team_stats %}
                        <tr {% if loop.index % 2 == 0 %}style="background: #f9f9f9;"{% endif %}>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">
                                <strong>{{ team.name }}</strong>
                            </td>
                            <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
                                <span class="player-count" style="background: #e3f2fd; padding: 4px 8px; border-radius: 12px; color: #1976d2;">
                                    {{ team.players }}
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">
                                <span style="font-weight: bold; color: #4caf50;">
                                    {{ "%.1f"|format(team.total_value) }}M
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">
                                <span style="font-weight: bold; color: #2196f3;">
                                    {{ "%.1f"|format(team.cash) }}M
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">
                                <span style="font-weight: bold; color: {% if team.remaining_budget > 50 %}#4caf50{% elif team.remaining_budget > 20 %}#ff9800{% else %}#f44336{% endif %};">
                                    {{ "%.1f"|format(team.remaining_budget) }}M
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Team Summary Stats -->
            <div class="team-summary" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: center;">
                    <div>
                        <strong>Valore Medio Rosa:</strong><br>
                        <span style="font-size: 18px; color: #4caf50;">
                            {{ "%.1f"|format(team_stats|sum(attribute='total_value') / team_stats|length) if team_stats else 0 }}M
                        </span>
                    </div>
                    <div>
                        <strong>Cassa Media:</strong><br>
                        <span style="font-size: 18px; color: #2196f3;">
                            {{ "%.1f"|format(team_stats|sum(attribute='cash') / team_stats|length) if team_stats else 0 }}M
                        </span>
                    </div>
                    <div>
                        <strong>Budget Medio Disponibile:</strong><br>
                        <span style="font-size: 18px; color: #ff9800;">
                            {{ "%.1f"|format(team_stats|sum(attribute='remaining_budget') / team_stats|length) if team_stats else 0 }}M
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Quick Actions -->
        <div class="quick-actions" style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h3 style="margin-top: 0;">Azioni Rapide</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="/market/free-agents" class="btn" style="background: #ff9800;">
                    üë• Visualizza Svincolati
                </a>
                <a href="/market" class="btn" style="background: #2196f3;">
                    üîç Ricerca Giocatori
                </a>
                <a href="/rose" class="btn" style="background: #4caf50;">
                    üìã Rose Squadre
                </a>
                <a href="/" class="btn" style="background: #9c27b0;">
                    üè† Home
                </a>
            </div>
        </div>
    </div>

    <style>
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-weight: bold;
        }

        .role-badge.role-p { background: #e3f2fd; color: #1976d2; }
        .role-badge.role-d { background: #e8f5e8; color: #388e3c; }
        .role-badge.role-c { background: #fff3e0; color: #f57c00; }
        .role-badge.role-a { background: #fce4ec; color: #c2185b; }

        .btn {
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
            font-weight: bold;
            transition: opacity 0.3s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .breadcrumb a {
            color: #2196f3;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .alert-error {
            background: #fee;
            color: #8a1f11;
            border: 1px solid #f5c2c2;
        }

        .table-responsive {
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .stats-overview {
                grid-template-columns: 1fr 1fr;
            }

            .team-summary > div {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
